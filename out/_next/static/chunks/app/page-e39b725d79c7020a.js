(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{258:function(e,n,t){Promise.resolve().then(t.bind(t,5721))},5721:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return Home}});var a=t(7437),s=t(3574),r=t.n(s),i=t(8475),o=t.n(i),l=t(2265),c=t(6962),d=t(3405);let u="2RLwmjFijKkoRko-9Mr6aJBQFRaV1OB3Q8IeOFNuqRI";function Home(){let[e,n]=(0,l.useState)(!1),[t,s]=(0,l.useState)(!1),[i,g]=(0,l.useState)([]),{connected:m,connect:h,disconnect:f}=(0,c.useConnection)(),w=(0,c.useActiveAddress)(),v=(0,c.usePermissions)(),[y,p]=(0,l.useState)(!1),b=(0,a.jsx)(c.ConnectButton,{profileModal:!1,showBalance:!0}),k=(0,l.useCallback)(()=>{console.log("login???"),n(!0)},[n,s]),L=(0,l.useCallback)(()=>{let e=(0,d.q4)(u,globalThis.arweaveWallet);e.then(e=>{let n=null==e?void 0:e.msg[0].Tags;for(let e=0;e<n.length;e++){let t=n[e];if("Randoms"==t.name){window.unityInstance.SendMessage("SigninManager","OnGameStart",t.value);break}}})},[i]),x=(0,l.useCallback)(e=>{let n=e.detail.score;n>0&&((0,d.KW)(u,globalThis.arweaveWallet,n,e.detail.checkSum),syncBalance())},[i]);function handleLoginRet(){if(m&&!t){var e="".concat(null==w?void 0:w.substr(0,3),"...").concat(null==w?void 0:w.substr(-5));console.log("sign In:"+e),console.log(v),s(!0),window.unityInstance.SendMessage("SigninManager","OnPlatformLoginMsg",JSON.stringify({id:w,username:e,channel:"ao"})),syncBalance(),setTimeout(()=>{p(!0)},3e3)}}async function syncBalance(){if(w){let e=await (0,d.mV)(u,w),n=parseInt(e);window.unityInstance.SendMessage("SigninManager","OnScoreChanged",n)}}function LoginForm(e){let{}=e;return((0,l.useEffect)(()=>{!m||y||null==w||t||(console.log("===loged:"+w),handleLoginRet())}),y)?(0,a.jsx)("div",{}):(0,a.jsx)("div",{className:"modal"})}let U=(0,l.useCallback)(()=>{f()},[]),j=(0,l.useCallback)(e=>{let n=e.detail.taskId;n>0&&((0,d.Jo)(u,globalThis.arweaveWallet,n),syncBalance())},[]);return(0,l.useEffect)(()=>(window.addEventListener("GameLogout",U),()=>{window.removeEventListener("GameLogout",U)}),[U]),(0,l.useEffect)(()=>(window.addEventListener("GameLogin",k),()=>{window.removeEventListener("GameLogin",k)}),[k]),(0,l.useEffect)(()=>(window.addEventListener("GameBegin",L),()=>{window.removeEventListener("GameBegin",L)}),[k]),(0,l.useEffect)(()=>(window.addEventListener("GameOver",x),()=>{window.removeEventListener("GameOver",x)}),[x]),(0,l.useEffect)(()=>(window.addEventListener("FinishTask",j),()=>{window.removeEventListener("FinishTask",j)}),[j]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(r(),{children:[(0,a.jsx)("meta",{charSet:"utf-8"}),(0,a.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,a.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),(0,a.jsx)("meta",{name:"format-detection",content:"telephone=no"}),(0,a.jsx)("meta",{name:"renderer",content:"webkit"}),(0,a.jsx)("meta",{name:"force-rendering",content:"webkit"}),(0,a.jsx)("meta",{httpEquiv:"X-UA-Compatible",content:"IE=edge,chrome=1"}),(0,a.jsx)("meta",{name:"msapplication-tap-highlight",content:"no"}),(0,a.jsx)("meta",{name:"full-screen",content:"yes"}),(0,a.jsx)("meta",{name:"x5-fullscreen",content:"true"}),(0,a.jsx)("meta",{name:"360-fullscreen",content:"true"}),(0,a.jsx)("link",{rel:"shortcut icon",href:"TemplateData/favicon.ico"})]}),(0,a.jsxs)("div",{id:"game-container",children:[(0,a.jsx)("canvas",{id:"unity-canvas"}),(0,a.jsxs)("div",{id:"loaderContainer",children:[(0,a.jsx)("img",{src:"./TemplateData/03.gif",id:"logo"}),(0,a.jsx)("img",{src:"./TemplateData/loading.gif",id:"loading"}),(0,a.jsxs)("div",{id:"unity-loading-bar",children:[(0,a.jsx)("div",{id:"unity-webgl-logo"}),(0,a.jsx)("div",{id:"unity-progress-bar-empty",children:(0,a.jsx)("div",{id:"unity-progress-bar-full"})})]})]})]}),e&&!y&&(0,a.jsx)(LoginForm,{}),(0,a.jsx)("div",{className:"fixed-center-container",children:e&&!y&&b}),(0,a.jsx)(o(),{strategy:"lazyOnload",id:"game-script",children:'\n      var canvas = document.querySelector("#unity-canvas");\n      var progressBarFull = document.querySelector("#unity-progress-bar-full");\n\n      var defaultHeight = 1280;\n      var defaultWidth = 720;\n      var h = defaultHeight;\n      var w = defaultWidth;\n\n      // Shows a temporary message banner/ribbon for a few seconds, or\n      // a permanent error message on top of the canvas if type==\'error\'.\n      // If type==\'warning\', a yellow highlight color is used.\n      // Modify or remove this function to customize the visually presented\n      // way that non-critical warnings and error messages are presented to the\n      // user.\n\n      function closeLoading() {\n        var loaderContainer = document.getElementById(\'loaderContainer\');\n        if (loaderContainer)\n          loaderContainer.remove();\n      }\n\n      var buildUrl = "Build";\n      var loaderUrl = buildUrl + "/8b13ac280e9fffae9d25d21ee297d34d.loader.js";\n      var config = {\n        dataUrl: buildUrl + "/aba9b4a8aed4b8f51c3079e8a9b3569d.data.unityweb",\n        frameworkUrl: buildUrl + "/bcb2ba944e2cea6dd52104a6c44eae13.framework.js.unityweb",\n        codeUrl: buildUrl + "/472390ed8ebd1ebd3a18bc1314dd6313.wasm.unityweb",\n        cacheControl: function(url) {\n          // Caching enabled for .data and .bundle files. \n          // Revalidate if file is up to date before loading from cache\n          if (url.match(/.data/) || url.match(/.unityweb/) || url.match(/.ab/) || url.match(/.bundle/)) {\n            return "must-revalidate";\n          }\n  \n          // Caching enabled for .mp4 and .custom files\n          // Load file from cache without revalidation.\n          if (url.match(/.mp4/) || url.match(/.custom/)) {\n            return "immutable";\n          }\n  \n          // Disable explicit caching for all other files.\n          // Note: the default browser cache may cache them anyway.\n          return "no-store";\n        },\n        streamingAssetsUrl: "StreamingAssets",\n        companyName: "DefaultCompany",\n        productName: "puzzlegame_telegram",\n        productVersion: "1.0",\n        // showBanner: unityShowBanner,\n      };\n\n      // By default Unity keeps WebGL canvas render target size matched with\n      // the DOM size of the canvas element (scaled by window.devicePixelRatio)\n      // Set this to false if you want to decouple this synchronization from\n      // happening inside the engine, and you would instead like to size up\n      // the canvas DOM size and WebGL render target sizes yourself.\n      // config.matchWebGLToCanvasSize = false;\n\n      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {\n        h = window.innerHeight;\n        w = window.innerWidth;\n        // Mobile device style: fill the whole browser client area with the game canvas:\n    \n        // To lower canvas resolution on mobile devices to gain some\n        // performance, uncomment the following line:\n        // config.devicePixelRatio = 1;\n    \n        // unityShowBanner(\'WebGL builds are not supported on mobile devices.\');\n      } else {\n        // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:\n        var height = window.innerHeight;\n        var width = window.innerWidth;\n       \n    \n        if(width < height * defaultWidth / defaultHeight) {\n          h = width * defaultHeight / defaultWidth;\n          w = width;\n        }\n        else {\n          h = height;\n          w = height * defaultWidth / defaultHeight;\n        }\n      }\n      var canvas = document.querySelector("#unity-canvas");\n      canvas.style.width = w + "px";\n      canvas.style.height = h + "px";\n      \n      var script = document.createElement("script");\n      script.src = loaderUrl;\n      script.onload = () => {\n        createUnityInstance(canvas, config, (progress) => {\n          progressBarFull.style.width = 100 * progress + "%";\n        }).then((unityInstance) => {\n          window.unityInstance = unityInstance;\n          setTimeout(() => {\n            closeLoading();\n          }, 2000);\n        }).catch((message) => {\n          alert(message);\n        });\n      };\n      document.body.appendChild(script);\n      '})]})}},3405:function(e,n,t){"use strict";t.d(n,{mV:function(){return AoTokenBalanceDryRun},Jo:function(){return FinishTask},KW:function(){return GameOver},q4:function(){return GameStart}});var a=t(6294);t(7778);let s="https://mu.ao-testnet.xyz",r="https://cu.ao-testnet.xyz",i="https://arweave.net",AoGetMessage=async(e,n)=>{try{let{result:t}=(0,a.$j)({MU_URL:s,CU_URL:r,GATEWAY_URL:i}),o=await t({process:e,message:n});return o}catch(e){console.error("AoGetMessage Error:",e)}};e=t.hmd(e);let AoTokenBalanceDryRun=async(e,n)=>{try{if(e&&43!=e.length||n&&43!=n.length||"string"!=typeof e||"string"!=typeof n)return;let{dryrun:t}=(0,a.$j)({MU_URL:s,CU_URL:r,GATEWAY_URL:i}),o=await t({Owner:n,process:e,data:null,tags:[{name:"Action",value:"Balance"},{name:"Target",value:n},{name:"Data-Protocol",value:"ao"},{name:"Type",value:"Message"},{name:"Variant",value:"ao.TN.1"}]});if(o&&o.Messages&&o.Messages[0]&&o.Messages[0].Data)return o.Messages[0].Data;return}catch(e){if(console.error("AoTokenBalanceDryRun Error:",e),e&&e.message)return{status:"error",msg:e.message};return}},GameStart=async(e,n)=>{try{if(e&&43!=e.length||"string"!=typeof e)return{};let{message:t}=(0,a.$j)({MU_URL:s,CU_URL:r,GATEWAY_URL:i}),o=await t({process:e,tags:[{name:"Action",value:"Play"},{name:"Target",value:e}],signer:(0,a.a7)(n)});if(!o||43!=o.length)return console.log(o),{status:"ok",id:o};{let n=await AoGetMessage(e,o);return console.log(n),{status:"ok",id:o,msg:null==n?void 0:n.Messages}}}catch(e){if(console.error("AoTokenTransfer Error:",e),e&&e.message)return{status:"error",msg:e.message}}},GameOver=async(e,n,t,o)=>{try{if(e&&43!=e.length||"string"!=typeof e)return;let{message:l}=(0,a.$j)({MU_URL:s,CU_URL:r,GATEWAY_URL:i}),c=await l({process:e,tags:[{name:"Action",value:"Exit"},{name:"Score",value:t.toString()},{name:"CheckSum",value:o.toString()}],signer:(0,a.a7)(n)});if(!c||43!=c.length)return console.log(c),{status:"ok",id:c};{let n=await AoGetMessage(e,c);return console.log(n),{status:"ok",id:c,msg:n}}}catch(e){if(console.error("AoTokenTransfer Error:",e),e&&e.message)return{status:"error",msg:e.message}}},FinishTask=async(e,n,t)=>{try{if(e&&43!=e.length||"string"!=typeof e)return;let{message:o}=(0,a.$j)({MU_URL:s,CU_URL:r,GATEWAY_URL:i}),l=await o({process:e,tags:[{name:"Action",value:"FinishTask"},{name:"TaskId",value:t.toString()}],signer:(0,a.a7)(n)});if(!l||43!=l.length)return console.log(l),{status:"ok",id:l};{let n=await AoGetMessage(e,l);return console.log(n),{status:"ok",id:l,msg:n}}}catch(e){if(console.error("AoTokenTransfer Error:",e),e&&e.message)return{status:"error",msg:e.message}}}}},function(e){e.O(0,[858,47,366,626,971,472,744],function(){return e(e.s=258)}),_N_E=e.O()}]);